import{a as ae}from"./chunk-4AIEACKI.js";import{a as Ce}from"./chunk-EQHQ4Y7J.js";import{a as U}from"./chunk-GJGFDSP2.js";import{a as H,b as W,d as Y}from"./chunk-MUZ3M3VV.js";import{c as me,d as de,e as ue,f as pe,g as fe,h as he,i as ge,o as _e,p as xe}from"./chunk-P55RBNVH.js";import{b as z,c as u,e as Q,f as J,h as D,i as K,k as X,l as ee,m as te,n as ie,r as ne,t as re}from"./chunk-SJWHKNDJ.js";import{V as ce,W as le}from"./chunk-7V4BNWQR.js";import{b as Z}from"./chunk-HJCXVHL5.js";import{Aa as y,Ea as L,Ia as d,O as k,Oa as a,Rb as G,S as A,Sb as $,X as P,Xa as o,Ya as n,Yb as R,Z as x,Za as p,ba as C,bb as v,ca as S,db as g,eb as f,f as w,hb as h,hc as oe,i as E,jc as se,k as N,l as j,m as T,oa as q,pb as s,qb as V,rb as _,s as I,ub as B,wa as l}from"./chunk-J3N4ITXW.js";var Ne=P;function je(t){return!!t[Ne]}var Te=Symbol("__destroy"),be=Symbol("__decoratorApplied");function Ee(t){return typeof t=="string"?Symbol(`__destroy__${t}`):Te}function ke(t){t.prototype[be]=!0}function Ie(t,e){t[e]||(t[e]=new E)}function De(t,e){t[e]&&(t[e].next(),t[e].complete(),t[e]=null)}function Fe(t){t instanceof w&&t.unsubscribe()}function Ae(t){Array.isArray(t)&&t.forEach(Fe)}function Oe(t,e){return function(){if(t&&t.call(this),De(this,Ee()),e.arrayName&&Ae(this[e.arrayName]),e.checkProperties)for(let i in this)e.blackList?.includes(i)||Fe(this[i])}}function Pe(t,e){t.prototype.ngOnDestroy=Oe(t.prototype.ngOnDestroy,e)}function qe(t,e){let i=t.\u0275pipe;i.onDestroy=Oe(i.onDestroy,e)}function Me(t={}){return e=>{je(e)?qe(e,t):Pe(e,t),ke(e)}}var Se=7,ye=Symbol("CheckerHasBeenSet");function Le(t,e){t[ye]||Ve()||(ve(()=>T(Promise.resolve()).pipe(I(()=>{let i;try{i=q(t)}catch{i=null}let r=i?.lView;if(r==null)return N;let c=r[Se]||(r[Se]=[]),m=new E;return c.push(function(){ve(()=>{m.next(),m.complete()})}),m}),I(()=>Promise.resolve())).subscribe(()=>{(e.observed??e.observers.length>0)&&console.warn(Be(t))})),t[ye]=!0)}function Ve(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]"}function ve(t){let e=A.Zone;return!!e&&typeof e.root?.run=="function"?e.root.run(t):t()}function Be(t){return`
  The ${t.constructor.name} still has subscriptions that haven't been unsubscribed.
  This may happen if the class extends another class decorated with @UntilDestroy().
  The child class implements its own ngOnDestroy() method but doesn't call super.ngOnDestroy().
  Let's look at the following example:
  @UntilDestroy()
  @Directive()
  export abstract class BaseDirective {}
  @Component({ template: '' })
  export class ConcreteComponent extends BaseDirective implements OnDestroy {
    constructor() {
      super();
      someObservable$.pipe(untilDestroyed(this)).subscribe();
    }
    ngOnDestroy(): void {
      // Some logic here...
    }
  }
  The BaseDirective.ngOnDestroy() will not be called since Angular will call ngOnDestroy()
  on the ConcreteComponent, but not on the BaseDirective.
  One of the solutions is to declare an empty ngOnDestroy method on the BaseDirective:
  @UntilDestroy()
  @Directive()
  export abstract class BaseDirective {
    ngOnDestroy(): void {}
  }
  @Component({ template: '' })
  export class ConcreteComponent extends BaseDirective implements OnDestroy {
    constructor() {
      super();
      someObservable$.pipe(untilDestroyed(this)).subscribe();
    }
    ngOnDestroy(): void {
      // Some logic here...
      super.ngOnDestroy();
    }
  }
  `}var F=!1;function Ge(t,e,i){let r=t[e];if(F&&typeof r!="function")throw new Error(`${t.constructor.name} is using untilDestroyed but doesn't implement ${e}`);Ie(t,i),t[e]=function(){r.apply(this,arguments),De(this,i),t[e]=r}}function b(t,e){return i=>{let r=Ee(e);typeof e=="string"?Ge(t,e,r):(F&&$e(t),Ie(t,r));let c=t[r];return F&&Le(t,c),i.pipe(k(c))}}function $e(t){let e=Object.getPrototypeOf(t);if(!(be in e))throw new Error("untilDestroyed operator cannot be used inside directives or components or providers that are not decorated with UntilDestroy decorator")}var Re=()=>["multiple-choice","matching"];function Ue(t,e){t&1&&(o(0,"h1"),s(1,"Cr\xE9er une Section et ses Exercices"),n())}function Ze(t,e){t&1&&(o(0,"h1"),s(1,"Modifier une Section et ses Exercices"),n())}function He(t,e){t&1&&(o(0,"mat-error"),s(1," Le titre est requis. "),n())}function We(t,e){if(t&1&&(o(0,"mat-option",17),s(1),n()),t&2){let i=e.$implicit;a("value",i.id),l(),_(" ",i.title," ")}}function Ye(t,e){if(t&1&&(o(0,"mat-option",17),s(1),n()),t&2){let i=e.$implicit;a("value",i.id),l(),_(" ",i.title," ")}}function ze(t,e){if(t&1&&(o(0,"mat-option",17),s(1),n()),t&2){let i=e.$implicit;a("value",i.id),l(),_(" ",i.title," ")}}function Qe(t,e){if(t&1&&(o(0,"mat-option",17),s(1),n()),t&2){let i=e.$implicit;a("value",i.id),l(),_(" ",i.title," ")}}function Je(t,e){t&1&&(o(0,"mat-error"),s(1," La le\xE7on est requise. "),n())}function Ke(t,e){if(t&1){let i=v();o(0,"div")(1,"mat-form-field",5),p(2,"input",37),n(),o(3,"button",21),g("click",function(){let c=C(i).index,m=f(2).index,M=f();return S(M.removeOption(m,c))}),o(4,"mat-icon"),s(5,"delete"),n()()()}if(t&2){let i=e.index;l(2),a("formControlName",i)}}function Xe(t,e){if(t&1){let i=v();o(0,"div")(1,"mat-label"),s(2,"Options :"),n(),o(3,"div",35),d(4,Ke,6,1,"div",36),n(),o(5,"button",15),g("click",function(){C(i);let c=f().index,m=f();return S(m.addOption(c))}),s(6," Ajouter une option "),n()()}if(t&2){let i=f().index,r=f();l(4),a("ngForOf",r.getOptions(i).controls)}}function et(t,e){if(t&1){let i=v();o(0,"div",18)(1,"h3",19)(2,"span",20),s(3),n(),s(4," Exercice "),o(5,"button",21),g("click",function(){let c=C(i).index,m=f();return S(m.removeExercice(c))}),o(6,"mat-icon"),s(7,"delete"),n()()(),o(8,"div",22)(9,"mat-form-field",5)(10,"mat-label"),s(11,"Consigne :"),n(),p(12,"input",23),n(),o(13,"mat-form-field",5)(14,"mat-label"),s(15,"Question :"),n(),p(16,"input",24),n(),o(17,"mat-form-field",5)(18,"mat-label"),s(19,"R\xE9ponse Correcte :"),n(),p(20,"input",25),n(),o(21,"mat-form-field",5)(22,"mat-label"),s(23,"Type :"),n(),o(24,"mat-select",26)(25,"mat-option",27),s(26,"Compl\xE9ter les blancs"),n(),o(27,"mat-option",28),s(28,"Choix multiples"),n(),o(29,"mat-option",29),s(30,"Dict\xE9e"),n()()(),d(31,Xe,7,1,"div",1),o(32,"mat-form-field",5)(33,"mat-label"),s(34,"Difficult\xE9 :"),n(),o(35,"mat-select",30)(36,"mat-option",31),s(37,"Facile"),n(),o(38,"mat-option",32),s(39,"Moyenne"),n(),o(40,"mat-option",33),s(41,"Difficile"),n()()(),o(42,"mat-form-field",5)(43,"mat-label"),s(44,"Explication :"),n(),p(45,"textarea",34),n()()()}if(t&2){let i,r=e.$implicit,c=e.index;a("formGroupName",c),l(3),V(c+1),l(9),h("id","consigne-",c,""),l(4),h("id","question-",c,""),l(4),h("id","correct_answer-",c,""),l(4),h("id","type-",c,""),l(7),a("ngIf",B(15,Re).includes((i=r.get("type"))==null?null:i.value)),l(4),h("id","difficulty-",c,""),l(10),h("id","explanation-",c,"")}}var we=class O{constructor(e,i,r){this.fb=e,this.fullStructureSubjectsService=i,this.activatedRoute=r,this.fullStructure=[],this.courses=[],this.sectionId=null,this.isEditing=!1,this.selectedClassId="",this.selectedCourseId="",this.selectedCategoryId="",this.selectedClass=null,this.selectedCourse=null,this.selectedCategory=null,this.exercicesService=x(U),this.exerciceSectionService=x(Z),this.router=x(se),this.form=this.fb.group({section:this.fb.group({title:["",u.required],description:[""],created_by:[Ce.ADMIN],class_id:["",u.required],lesson_id:["",u.required],category_id:["",u.required],subLesson_id:["",u.required]}),exercices:this.fb.array([])}),this.onLessonChange(),this.onClassChange(),this.onCategoryChange()}ngOnInit(){this.getStructureSubjects(),this.activatedRoute.paramMap.subscribe(e=>{this.sectionId=e.get("sectionId"),this.sectionId&&(this.isEditing=!0,this.loadSectionData(this.sectionId))})}getStructureSubjects(){this.fullStructureSubjectsService.getFullStructureSubjects().subscribe({next:e=>{this.fullStructure=e,this.courses=e},error:e=>{console.error("Erreur lors du chargement des le\xE7ons:",e)}})}loadSectionData(e){this.exerciceSectionService.getSectionWithExercices(e).subscribe({next:i=>{this.form.patchValue({section:i.section}),this.selectedClassId=i.section.class_id,this.selectedClass=this.fullStructure.find(r=>r.id===this.selectedClassId),this.selectedCourseId=i.section.lesson_id,this.selectedCourse=this.selectedClass?.children.find(r=>r.id===this.selectedCourseId),this.selectedCategoryId=i.section.category_id,this.selectedCategory=this.selectedCourse?.children.find(r=>r.id===this.selectedCategoryId),this.exercices.clear(),i.exercices.forEach(r=>{this.exercices.push(this.createExerciceForm(r))})},error:i=>{console.error("Erreur lors du chargement de la section:",i)}})}onClassChange(){this.form.get("section.class_id")?.valueChanges.pipe(b(this)).subscribe(e=>{this.selectedClassId=e,this.selectedClass=this.fullStructure.find(i=>i.id===this.selectedClassId),this.selectedCourseId="",this.selectedCategoryId="",this.selectedCourse=null,this.selectedCategory=null})}onLessonChange(){this.form.get("section.lesson_id")?.valueChanges.pipe(b(this)).subscribe(e=>{this.selectedCourseId=e,this.selectedCourse=this.selectedClass?.children.find(i=>i.id===this.selectedCourseId),this.selectedCategoryId="",this.selectedCategory=null})}onCategoryChange(){this.form.get("section.category_id")?.valueChanges.pipe(b(this)).subscribe(e=>{this.selectedCategoryId=e,this.selectedCategory=this.selectedCourse?.children.find(i=>i.id===this.selectedCategoryId)})}get exercices(){return this.form.get("exercices")}addExercice(){this.exercices.push(this.createExerciceForm())}removeExercice(e){this.exercices.removeAt(e)}createExerciceForm(e={}){return this.fb.group({type:[e.type||"fill-in-the-blank",u.required],consigne:[e.consigne||""],question:[e.question||"",u.required],correct_answer:[e.correct_answer||"",u.required],options:this.fb.array(e.options?e.options.map(i=>new D(i)):[]),explanation:[e.explanation||""],difficulty:[e.difficulty||"easy",u.required],section_id:[e.section_id||""]})}getOptions(e){return this.exercices.at(e).get("options")}addOption(e){this.getOptions(e).push(new D("",u.required))}removeOption(e,i){this.getOptions(e).removeAt(i)}submit(){this.form.valid?this.isEditing&&this.sectionId?this.updateSection(this.sectionId,this.form.value):this.createSection(this.form.value):alert("Veuillez remplir tous les champs requis.")}createSection(e){this.exerciceSectionService.createSectionWithExercices(e).subscribe({next:()=>{alert("Section et exercices cr\xE9\xE9s avec succ\xE8s !"),this.router.navigate(["/my-space/sections"])},error:i=>{alert("Erreur lors de l'enregistrement."),console.error(i)}})}updateSection(e,i){this.exerciceSectionService.updateSectionWithExercices(e,i).subscribe({next:()=>{alert("Section et exercices mis \xE0 jour avec succ\xE8s !"),this.router.navigate(["/my-space/sections"])},error:r=>{alert("Erreur lors de la mise \xE0 jour."),console.error(r)}})}static{this.\u0275fac=function(i){return new(i||O)(y(ne),y(ae),y(oe))}}static{this.\u0275cmp=L({type:O,selectors:[["app-section-exercice-form"]],decls:49,vars:10,consts:[[1,"section-exercice-container"],[4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"primary-color"],["formGroupName","section",1,"grid-form"],["appearance","fill"],["matInput","","formControlName","title","type","text"],["formControlName","class_id"],[3,"value",4,"ngFor","ngForOf"],["formControlName","lesson_id"],["formControlName","category_id"],["formControlName","subLesson_id"],["matInput","","formControlName","description"],["formArrayName","exercices"],["class","box-border-radius",3,"formGroupName",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","accent","type","submit"],[3,"value"],[1,"box-border-radius",3,"formGroupName"],[1,"box-exercice-form"],[1,"item-numero"],["mat-icon-button","",3,"click"],[1,"grid-form"],["matInput","","formControlName","consigne","type","text",3,"id"],["matInput","","formControlName","question","type","text",3,"id"],["matInput","","formControlName","correct_answer","type","text",3,"id"],["formControlName","type",3,"id"],["value","fill-in-the-blank"],["value","multiple-choice"],["value","dictation"],["formControlName","difficulty",3,"id"],["value","easy"],["value","medium"],["value","hard"],["matInput","","formControlName","explanation",3,"id"],["formArrayName","options"],[4,"ngFor","ngForOf"],["matInput","","type","text",3,"formControlName"]],template:function(i,r){if(i&1&&(o(0,"div",0),d(1,Ue,2,0,"h1",1)(2,Ze,2,0,"h1",1),o(3,"form",2),g("ngSubmit",function(){return r.submit()}),o(4,"h2",3),s(5,"Section"),n(),o(6,"div",4)(7,"mat-form-field",5)(8,"mat-label"),s(9,"Titre de la Section :"),n(),p(10,"input",6),d(11,He,2,0,"mat-error",1),n(),o(12,"mat-form-field",5)(13,"mat-label"),s(14,"Classes :"),n(),o(15,"mat-select",7),d(16,We,2,2,"mat-option",8),n()(),o(17,"mat-form-field",5)(18,"mat-label"),s(19,"Le\xE7on :"),n(),o(20,"mat-select",9),d(21,Ye,2,2,"mat-option",8),n()(),o(22,"mat-form-field",5)(23,"mat-label"),s(24,"Cat\xE9gorie :"),n(),o(25,"mat-select",10),d(26,ze,2,2,"mat-option",8),n()(),o(27,"mat-form-field",5)(28,"mat-label"),s(29,"Sous-Le\xE7on :"),n(),o(30,"mat-select",11),d(31,Qe,2,2,"mat-option",8),n()(),d(32,Je,2,0,"mat-error",1),o(33,"mat-form-field",5)(34,"mat-label"),s(35,"Description :"),n(),p(36,"textarea",12),n()(),o(37,"div",13)(38,"h2",3),s(39,"Exercices"),n(),d(40,et,46,16,"div",14),n(),o(41,"div")(42,"button",15),g("click",function(){return r.addExercice()}),s(43," Ajouter un Exercice "),n(),p(44,"br")(45,"br"),n(),o(46,"div")(47,"button",16),s(48," Enregistrer "),n()()()()),i&2){let c,m;l(),a("ngIf",!r.isEditing),l(),a("ngIf",r.isEditing),l(),a("formGroup",r.form),l(8),a("ngIf",((c=r.form.get("section.title"))==null?null:c.invalid)&&((c=r.form.get("section.title"))==null?null:c.touched)),l(5),a("ngForOf",r.courses),l(5),a("ngForOf",r.selectedClass==null?null:r.selectedClass.children),l(5),a("ngForOf",r.selectedCourse==null?null:r.selectedCourse.children),l(5),a("ngForOf",r.selectedCategory==null?null:r.selectedCategory.children),l(),a("ngIf",((m=r.form.get("section.lesson"))==null?null:m.invalid)&&((m=r.form.get("section.lesson"))==null?null:m.touched)),l(8),a("ngForOf",r.exercices.controls)}},dependencies:[R,G,$,re,K,z,Q,J,X,ie,ee,te,he,fe,ue,me,de,xe,_e,ge,Y,W,H,pe,le,ce],styles:[".grid-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.box-border-radius[_ngcontent-%COMP%]{border:2px solid #ff4081;padding:10px;border-radius:10px;margin-bottom:20px}.item-numero[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;width:30px;height:30px;line-height:3Opx;font-weight:700;color:#fff;text-align:center;background:#ff4081;border-radius:100%}.box-exercice-form[_ngcontent-%COMP%]{display:flex;justify-items:center;align-items:center;gap:5px;flex-direction:row}.primary-color[_ngcontent-%COMP%]{color:#ff4081}"]})}};we=j([Me()],we);export{we as SectionExercicesFormComponent};
