"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[494],{4494:(he,C,n)=>{n.r(C),n.d(C,{SectionExercicesFormComponent:()=>h});var R=n(1635),e=n(7705),m=n(177),r=n(9417),v=n(8498),G=n(3987),T=n(3693),M=n(8132),E=n(9631),b=n(2798),d=n(8834),a=n(882),F=n(9213),y=n(1413),Y=n(8359),B=(n(6648),n(983),n(1397),n(6977));const L=e.YHP,V=Symbol("__destroy"),S=Symbol("__decoratorApplied");function j(o){return"string"==typeof o?Symbol(`__destroy__${o}`):V}function k(o,t){o[t]||(o[t]=new y.B)}function _(o,t){o[t]&&(o[t].next(),o[t].complete(),o[t]=null)}function D(o){o instanceof Y.yU&&o.unsubscribe()}function I(o,t){return function(){if(o&&o.call(this),_(this,j()),t.arrayName&&function w(o){Array.isArray(o)&&o.forEach(D)}(this[t.arrayName]),t.checkProperties)for(const i in this)t.blackList?.includes(i)||D(this[i])}}Symbol("CheckerHasBeenSet");function p(o,t){return i=>{const s=j(t);"string"==typeof t?function K(o,t,i){const s=o[t];k(o,i),o[t]=function(){s.apply(this,arguments),_(this,i),o[t]=s}}(o,t,s):k(o,s);const c=o[s];return i.pipe((0,B.Q)(c))}}var ee=n(1494),te=n(6600);function oe(o,t){1&o&&(e.j41(0,"h1"),e.EFF(1,"Cr\xe9er une Section et ses Exercices"),e.k0s())}function ie(o,t){1&o&&(e.j41(0,"h1"),e.EFF(1,"Modifier une Section et ses Exercices"),e.k0s())}function se(o,t){1&o&&(e.j41(0,"mat-error"),e.EFF(1," Le titre est requis. "),e.k0s())}function ne(o,t){if(1&o&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&o){const i=t.$implicit;e.Y8G("value",i.id),e.R7$(1),e.SpI(" ",i.title," ")}}function re(o,t){if(1&o&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&o){const i=t.$implicit;e.Y8G("value",i.id),e.R7$(1),e.SpI(" ",i.title," ")}}function ce(o,t){if(1&o&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&o){const i=t.$implicit;e.Y8G("value",i.id),e.R7$(1),e.SpI(" ",i.title," ")}}function le(o,t){if(1&o&&(e.j41(0,"mat-option",17),e.EFF(1),e.k0s()),2&o){const i=t.$implicit;e.Y8G("value",i.id),e.R7$(1),e.SpI(" ",i.title," ")}}function ae(o,t){1&o&&(e.j41(0,"mat-error"),e.EFF(1," La le\xe7on est requise. "),e.k0s())}function ue(o,t){if(1&o){const i=e.RV6();e.j41(0,"div")(1,"mat-form-field",5),e.nrm(2,"input",37),e.k0s(),e.j41(3,"button",21),e.bIt("click",function(){const l=e.eBV(i).index,u=e.XpG(2).index,pe=e.XpG();return e.Njj(pe.removeOption(u,l))}),e.j41(4,"mat-icon"),e.EFF(5,"delete"),e.k0s()()()}if(2&o){const i=t.index;e.R7$(2),e.Y8G("formControlName",i)}}function me(o,t){if(1&o){const i=e.RV6();e.j41(0,"div")(1,"mat-label"),e.EFF(2,"Options :"),e.k0s(),e.j41(3,"div",35),e.DNE(4,ue,6,1,"div",36),e.k0s(),e.j41(5,"button",15),e.bIt("click",function(){e.eBV(i);const c=e.XpG().index,l=e.XpG();return e.Njj(l.addOption(c))}),e.EFF(6," Ajouter une option "),e.k0s()()}if(2&o){const i=e.XpG().index,s=e.XpG();e.R7$(4),e.Y8G("ngForOf",s.getOptions(i).controls)}}const de=function(){return["multiple-choice","matching"]};function fe(o,t){if(1&o){const i=e.RV6();e.j41(0,"div",18)(1,"h3",19)(2,"span",20),e.EFF(3),e.k0s(),e.EFF(4," Exercice "),e.j41(5,"button",21),e.bIt("click",function(){const l=e.eBV(i).index,u=e.XpG();return e.Njj(u.removeExercice(l))}),e.j41(6,"mat-icon"),e.EFF(7,"delete"),e.k0s()()(),e.j41(8,"div",22)(9,"mat-form-field",5)(10,"mat-label"),e.EFF(11,"Consigne :"),e.k0s(),e.nrm(12,"input",23),e.k0s(),e.j41(13,"mat-form-field",5)(14,"mat-label"),e.EFF(15,"Question :"),e.k0s(),e.nrm(16,"input",24),e.k0s(),e.j41(17,"mat-form-field",5)(18,"mat-label"),e.EFF(19,"R\xe9ponse Correcte :"),e.k0s(),e.nrm(20,"input",25),e.k0s(),e.j41(21,"mat-form-field",5)(22,"mat-label"),e.EFF(23,"Type :"),e.k0s(),e.j41(24,"mat-select",26)(25,"mat-option",27),e.EFF(26,"Compl\xe9ter les blancs"),e.k0s(),e.j41(27,"mat-option",28),e.EFF(28,"Choix multiples"),e.k0s(),e.j41(29,"mat-option",29),e.EFF(30,"Dict\xe9e"),e.k0s()()(),e.DNE(31,me,7,1,"div",1),e.j41(32,"mat-form-field",5)(33,"mat-label"),e.EFF(34,"Difficult\xe9 :"),e.k0s(),e.j41(35,"mat-select",30)(36,"mat-option",31),e.EFF(37,"Facile"),e.k0s(),e.j41(38,"mat-option",32),e.EFF(39,"Moyenne"),e.k0s(),e.j41(40,"mat-option",33),e.EFF(41,"Difficile"),e.k0s()()(),e.j41(42,"mat-form-field",5)(43,"mat-label"),e.EFF(44,"Explication :"),e.k0s(),e.nrm(45,"textarea",34),e.k0s()()()}if(2&o){const i=t.$implicit,s=t.index;let c;e.Y8G("formGroupName",s),e.R7$(3),e.JRh(s+1),e.R7$(9),e.Mz_("id","consigne-",s,""),e.R7$(4),e.Mz_("id","question-",s,""),e.R7$(4),e.Mz_("id","correct_answer-",s,""),e.R7$(4),e.Mz_("id","type-",s,""),e.R7$(7),e.Y8G("ngIf",e.lJ4(9,de).includes(null==(c=i.get("type"))?null:c.value)),e.R7$(4),e.Mz_("id","difficulty-",s,""),e.R7$(10),e.Mz_("id","explanation-",s,"")}}let h=class g{constructor(t,i,s){this.fb=t,this.fullStructureSubjectsService=i,this.activatedRoute=s,this.fullStructure=[],this.courses=[],this.sectionId=null,this.isEditing=!1,this.selectedClassId="",this.selectedCourseId="",this.selectedCategoryId="",this.selectedClass=null,this.selectedCourse=null,this.selectedCategory=null,this.exercicesService=(0,e.WQX)(T.I),this.exerciceSectionService=(0,e.WQX)(G.$),this.router=(0,e.WQX)(v.Ix),this.form=this.fb.group({section:this.fb.group({title:["",r.k0.required],description:[""],created_by:[M.gG.ADMIN],class_id:["",r.k0.required],lesson_id:["",r.k0.required],category_id:["",r.k0.required],subLesson_id:["",r.k0.required]}),exercices:this.fb.array([])}),this.onLessonChange(),this.onClassChange(),this.onCategoryChange()}ngOnInit(){this.getStructureSubjects(),this.activatedRoute.paramMap.subscribe(t=>{this.sectionId=t.get("sectionId"),this.sectionId&&(this.isEditing=!0,this.loadSectionData(this.sectionId))})}getStructureSubjects(){this.fullStructureSubjectsService.getFullStructureSubjects().subscribe({next:t=>{this.fullStructure=t,this.courses=t},error:t=>{console.error("Erreur lors du chargement des le\xe7ons:",t)}})}loadSectionData(t){this.exerciceSectionService.getSectionWithExercices(t).subscribe({next:i=>{this.form.patchValue({section:i.section}),this.selectedClassId=i.section.class_id,this.selectedClass=this.fullStructure.find(s=>s.id===this.selectedClassId),this.selectedCourseId=i.section.lesson_id,this.selectedCourse=this.selectedClass?.children.find(s=>s.id===this.selectedCourseId),this.selectedCategoryId=i.section.category_id,this.selectedCategory=this.selectedCourse?.children.find(s=>s.id===this.selectedCategoryId),this.exercices.clear(),i.exercices.forEach(s=>{this.exercices.push(this.createExerciceForm(s))})},error:i=>{console.error("Erreur lors du chargement de la section:",i)}})}onClassChange(){this.form.get("section.class_id")?.valueChanges.pipe(p(this)).subscribe(t=>{this.selectedClassId=t,this.selectedClass=this.fullStructure.find(i=>i.id===this.selectedClassId),this.selectedCourseId="",this.selectedCategoryId="",this.selectedCourse=null,this.selectedCategory=null})}onLessonChange(){this.form.get("section.lesson_id")?.valueChanges.pipe(p(this)).subscribe(t=>{this.selectedCourseId=t,this.selectedCourse=this.selectedClass?.children.find(i=>i.id===this.selectedCourseId),this.selectedCategoryId="",this.selectedCategory=null})}onCategoryChange(){this.form.get("section.category_id")?.valueChanges.pipe(p(this)).subscribe(t=>{this.selectedCategoryId=t,this.selectedCategory=this.selectedCourse?.children.find(i=>i.id===this.selectedCategoryId)})}get exercices(){return this.form.get("exercices")}addExercice(){this.exercices.push(this.createExerciceForm())}removeExercice(t){this.exercices.removeAt(t)}createExerciceForm(t={}){return this.fb.group({type:[t.type||"fill-in-the-blank",r.k0.required],consigne:[t.consigne||""],question:[t.question||"",r.k0.required],correct_answer:[t.correct_answer||"",r.k0.required],options:this.fb.array(t.options?t.options.map(i=>new r.MJ(i)):[]),explanation:[t.explanation||""],difficulty:[t.difficulty||"easy",r.k0.required],section_id:[t.section_id||""]})}getOptions(t){return this.exercices.at(t).get("options")}addOption(t){this.getOptions(t).push(new r.MJ("",r.k0.required))}removeOption(t,i){this.getOptions(t).removeAt(i)}submit(){this.form.valid?this.isEditing&&this.sectionId?this.updateSection(this.sectionId,this.form.value):this.createSection(this.form.value):alert("Veuillez remplir tous les champs requis.")}createSection(t){this.exerciceSectionService.createSectionWithExercices(t).subscribe({next:()=>{alert("Section et exercices cr\xe9\xe9s avec succ\xe8s !"),this.router.navigate(["/my-space/sections"])},error:i=>{alert("Erreur lors de l'enregistrement."),console.error(i)}})}updateSection(t,i){this.exerciceSectionService.updateSectionWithExercices(t,i).subscribe({next:()=>{alert("Section et exercices mis \xe0 jour avec succ\xe8s !"),this.router.navigate(["/my-space/sections"])},error:s=>{alert("Erreur lors de la mise \xe0 jour."),console.error(s)}})}static{this.\u0275fac=function(i){return new(i||g)(e.rXU(r.ok),e.rXU(ee.L),e.rXU(v.nX))}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["app-section-exercice-form"]],standalone:!0,features:[e.aNF],decls:49,vars:10,consts:[[1,"section-exercice-container"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"primary-color"],["formGroupName","section",1,"grid-form"],["appearance","fill"],["matInput","","formControlName","title","type","text"],["formControlName","class_id"],[3,"value",4,"ngFor","ngForOf"],["formControlName","lesson_id"],["formControlName","category_id"],["formControlName","subLesson_id"],["matInput","","formControlName","description"],["formArrayName","exercices"],["class","box-border-radius",3,"formGroupName",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","accent","type","submit"],[3,"value"],[1,"box-border-radius",3,"formGroupName"],[1,"box-exercice-form"],[1,"item-numero"],["mat-icon-button","",3,"click"],[1,"grid-form"],["matInput","","formControlName","consigne","type","text",3,"id"],["matInput","","formControlName","question","type","text",3,"id"],["matInput","","formControlName","correct_answer","type","text",3,"id"],["formControlName","type",3,"id"],["value","fill-in-the-blank"],["value","multiple-choice"],["value","dictation"],["formControlName","difficulty",3,"id"],["value","easy"],["value","medium"],["value","hard"],["matInput","","formControlName","explanation",3,"id"],["formArrayName","options"],[4,"ngFor","ngForOf"],["matInput","","type","text",3,"formControlName"]],template:function(i,s){if(1&i&&(e.j41(0,"div",0),e.DNE(1,oe,2,0,"h1",1),e.DNE(2,ie,2,0,"h1",1),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return s.submit()}),e.j41(4,"h2",3),e.EFF(5,"Section"),e.k0s(),e.j41(6,"div",4)(7,"mat-form-field",5)(8,"mat-label"),e.EFF(9,"Titre de la Section :"),e.k0s(),e.nrm(10,"input",6),e.DNE(11,se,2,0,"mat-error",1),e.k0s(),e.j41(12,"mat-form-field",5)(13,"mat-label"),e.EFF(14,"Classes :"),e.k0s(),e.j41(15,"mat-select",7),e.DNE(16,ne,2,2,"mat-option",8),e.k0s()(),e.j41(17,"mat-form-field",5)(18,"mat-label"),e.EFF(19,"Le\xe7on :"),e.k0s(),e.j41(20,"mat-select",9),e.DNE(21,re,2,2,"mat-option",8),e.k0s()(),e.j41(22,"mat-form-field",5)(23,"mat-label"),e.EFF(24,"Cat\xe9gorie :"),e.k0s(),e.j41(25,"mat-select",10),e.DNE(26,ce,2,2,"mat-option",8),e.k0s()(),e.j41(27,"mat-form-field",5)(28,"mat-label"),e.EFF(29,"Sous-Le\xe7on :"),e.k0s(),e.j41(30,"mat-select",11),e.DNE(31,le,2,2,"mat-option",8),e.k0s()(),e.DNE(32,ae,2,0,"mat-error",1),e.j41(33,"mat-form-field",5)(34,"mat-label"),e.EFF(35,"Description :"),e.k0s(),e.nrm(36,"textarea",12),e.k0s()(),e.j41(37,"div",13)(38,"h2",3),e.EFF(39,"Exercices"),e.k0s(),e.DNE(40,fe,46,10,"div",14),e.k0s(),e.j41(41,"div")(42,"button",15),e.bIt("click",function(){return s.addExercice()}),e.EFF(43," Ajouter un Exercice "),e.k0s(),e.nrm(44,"br")(45,"br"),e.k0s(),e.j41(46,"div")(47,"button",16),e.EFF(48," Enregistrer "),e.k0s()()()()),2&i){let c,l;e.R7$(1),e.Y8G("ngIf",!s.isEditing),e.R7$(1),e.Y8G("ngIf",s.isEditing),e.R7$(1),e.Y8G("formGroup",s.form),e.R7$(8),e.Y8G("ngIf",(null==(c=s.form.get("section.title"))?null:c.invalid)&&(null==(c=s.form.get("section.title"))?null:c.touched)),e.R7$(5),e.Y8G("ngForOf",s.courses),e.R7$(5),e.Y8G("ngForOf",null==s.selectedClass?null:s.selectedClass.children),e.R7$(5),e.Y8G("ngForOf",null==s.selectedCourse?null:s.selectedCourse.children),e.R7$(5),e.Y8G("ngForOf",null==s.selectedCategory?null:s.selectedCategory.children),e.R7$(1),e.Y8G("ngIf",(null==(l=s.form.get("section.lesson"))?null:l.invalid)&&(null==(l=s.form.get("section.lesson"))?null:l.touched)),e.R7$(8),e.Y8G("ngForOf",s.exercices.controls)}},dependencies:[m.MD,m.Sq,m.bT,r.X1,r.qT,r.me,r.BC,r.cb,r.j4,r.JD,r.$R,r.v8,E.fS,E.fg,a.rl,a.nJ,a.TL,b.Ve,b.VO,te.wT,d.Hl,d.$z,d.iY,a.RG,F.m_,F.An],styles:[".grid-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}.box-border-radius[_ngcontent-%COMP%]{border:2px solid #ff4081;padding:10px;border-radius:10px;margin-bottom:20px}.item-numero[_ngcontent-%COMP%]{display:inline-flex;justify-content:center;width:30px;height:30px;line-height:3Opx;font-weight:700;color:#fff;text-align:center;background:#ff4081;border-radius:100%}.box-exercice-form[_ngcontent-%COMP%]{display:flex;justify-items:center;align-items:center;gap:5px;flex-direction:row}.primary-color[_ngcontent-%COMP%]{color:#ff4081}"]})}};h=(0,R.Cg)([function Z(o={}){return t=>{!function X(o){return!!o[L]}(t)?function z(o,t){o.prototype.ngOnDestroy=I(o.prototype.ngOnDestroy,t)}(t,o):function J(o,t){const i=o.\u0275pipe;i.onDestroy=I(i.onDestroy,t)}(t,o),function U(o){o.prototype[S]=!0}(t)}}()],h)}}]);